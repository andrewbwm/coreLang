/*
 * Copyright 2019-2021 coreLang contributors <https://mal-lang.org/coreLang/contributors.html>
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

category Vulnerability {

  asset SoftwareVulnerability extends Vulnerability
    user info: "A vulnerability that affects software(Applications or Software Products)."
  {
    # networkAccessRequired [Disabled]
      user info: "Network access is required to abuse the vulnerability."
      -> networkAccessAchieved,
         softwareProduct.softApplications.softwareProductVulnerabilityNetworkAccessAchieved

    # localAccessRequired [Disabled]
      user info: "Local access is required to abuse the vulnerability."
      -> localAccessAchieved,
         softwareProduct.softApplications.softwareProductVulnerabilityLocalAccessAchieved

    # physicalAccessRequired [Disabled]
      user info: "Physical access is required to abuse the vulnerability."
      -> physicalAccessAchieved,
         softwareProduct.softApplications.softwareProductVulnerabilityPhysicalAccessAchieved

    # lowPrivilegesRequired [Disabled]
      user info: "Low privileges are required to abuse the vulnerability."
      -> lowPrivilegesAchieved,
         softwareProduct.softApplications.softwareProductVulnerabilityLowPrivilegesAchieved

    # highPrivilegesRequired [Disabled]
      user info: "High privileges are required to abuse the vulnerability."
      -> highPrivilegesAchieved,
         softwareProduct.softApplications.softwareProductVulnerabilityHighPrivilegesAchieved

    # userInteractionRequired [Disabled]
      user info: "Some exploits require user interaction. This defense should specify the probability of such interaction on the given application."
      -> userInteractionAchieved

    # confidentialityImpactLimitations
      user info: "Limits the impact on confidentiality of the vulnerability."
      -> read

    # availabilityImpactLimitations
      user info: "Limits the impact on availability of the vulnerability."
      -> deny

    # integrityImpactLimitations
      user info: "Limits the impact on integrity of the vulnerability."
      -> modify

    # exploitComplexity
      user info: "The complexity of the exploit reduces the likelihood that it can be successfully utilised."
      -> exploit

    # exploitImmaturity
      user info: "The less mature an exploit is the more difficult it is for the vulnerability to be leveraged."
      -> exploit

    | networkAccessAchieved
      developer info: "Intermediate attack step to model network access requirement."
      ->  abuse

    | localAccessAchieved
      developer info: "Intermediate attack step to model local access requirement."
      ->  abuse

    | physicalAccessAchieved
      developer info: "Intermediate attack step to model physical access requirement."
      ->  abuse

    | lowPrivilegesAchieved
      developer info: "Intermediate attack step to model low privileges requirement."
      ->  abuse

    | highPrivilegesAchieved
      developer info: "Intermediate attack step to model high privileges requirement."
      ->  abuse

    | userInteractionAchieved
      developer info: "Intermediate attack step to model user interaction defense."
      ->  abuse

    & read
      user info: "The attacker can read some or all of this applications's code and data."
      ->  application.read,
          softwareProduct.readApplication

    & modify
     user info: "The attacker can modify some or all of this application's data."
      ->  application.modify,
          softwareProduct.modifyApplication

    & deny
      user info: "Denial-of-service attack is an attack in where a machine or network resource is rendered unavailable to its intended users by temporarily or indefinitely disrupting it"
      ->  application.deny,
          softwareProduct.denyApplication

    | impact
      user info: "The actual impact caused by successfully exploiting the vulnerability."
      -> read,
         modify,
         deny
  }

  asset UnknownSoftwareVulnerability extends SoftwareVulnerability
    developer info: "Meant to capture vulnerabilities without CVE or to model what-if scenarios where the parser controls the impact and distribution based on e.g., Attacker Profiles"
  {
    | impact @hidden
      ->  requestForgery,
          modify,
          deny,
          read

    | requestForgery
      user info: "Request Forgery attacks occur when the attacker can create or control transmissions from a vulnerable application."
      ->  application.appConnections.transmit,
          application.appConnections.transmitResponse

    & modify @Override
     user info: "The attacker can modify some or all of this application's data."
      ->  application.modify,
          softwareProduct.modifyApplication

    & deny @Override
      user info: "Denial-of-service attack is an attack in where a machine or network resource is rendered unavailable to its intended users by temporarily or indefinitely disrupting it"
      ->  application.deny,
          softwareProduct.denyApplication

    & read @Override
      user info: "The attacker can read some or all of this applications's code and data."
      ->  application.read,
          softwareProduct.readApplication
  }


}

associations {
  SoftwareVulnerability               [vulnerabilities]   * <-- ApplicationVulnerability --> 0..1 [application]     Application
      developer info: "Every Application can also be connected to any Vulnerability."
  SoftwareVulnerability    [softProductVulnerabilities]   * <-- ApplicationVulnerability --> 0..1 [softwareProduct] SoftwareProduct
      developer info: "Every SoftwareProduct can also be connected to any Vulnerability."
}
